---
title: "Thesis Clustering"
output: html_notebook
---

Libs
```{r}
library(tidyverse)
library(ggplot2)
library(data.table)
library(reshape2)
library(dplyr)
library(caret)
library("Hmisc")
library(corrplot)
library(e1071)
```

Loading the Data - lies
```{r}
filenames_L_train <- list.files("~/Desktop/projects/thesis/R-OpenFace/df/deceptive/train", pattern="*.csv", full.names=TRUE)
filenames_L_test <- list.files("~/Desktop/projects/thesis/R-OpenFace/df/deceptive/test", pattern="*.csv", full.names=TRUE)
lies_train <- rbindlist(lapply(filenames_L_train, fread))
lies_test <- rbindlist(lapply(filenames_L_test, fread))
lies <- rbind(lies_test, lies_train)

# Remove Useless Columns
lies_train <- lies_train[,-c(1:5)]
lies_test <- lies_test[,-c(1:5)]

# Remove Intensity Columns
lint_train <- lies_train[,c(1:17)]
lies_train <- lies_train[,-c(1:17)]
lint_test <- lies_test[,c(1:17)]
lies_test <- lies_test[,-c(1:17)]
lies <- lies[,-c(1:22)]
```

Loading the Data - truth
```{r}
filenames_T_train <- list.files("~/Desktop/projects/thesis/R-OpenFace/df/truthful/train", pattern="*.csv", full.names=TRUE)
filenames_T_test <- list.files("~/Desktop/projects/thesis/R-OpenFace/df/truthful/test", pattern="*.csv", full.names=TRUE)
truth_train <- rbindlist(lapply(filenames_T_train, fread))
truth_test <- rbindlist(lapply(filenames_T_test, fread))
truth <- rbind(truth_train, truth_test)

# Remove Useless Columns
truth_train <- truth_train[,-c(1:5)]
truth_test <- truth_test[,-c(1:5)]

# Remove Intensity Columns
tint_train <- truth_train[,c(1:17)]
truth_train <- truth_train[,-c(1:17)]
tint_test <- truth_test[,c(1:17)]
truth_test <- truth_test[,-c(1:17)]
```

Utils
```{r}
makeAllCorrMatrix <- function(data) {
  correlation <- cor(data)
  rcorrelation <- rcorr(as.matrix(data))
  # Standard Cor with 5 Clustering
  corrplot(
  correlation,
  order = "hclust",
  addrect = 5,
  title = "Standard Cor with 5 Clustering",
  mar = c(0, 0, 1, 0)
  )
  # Mixed Cor
  corrplot.mixed(
  correlation,
  lower.col = "black",
  number.cex = 0.55,
  tl.cex = 0.4,
  upper = "color",
  order = "hclust",
  tl.col = "black",
  tl.srt = 45,
  title = "Mixed Cor",
  mar = c(0, 0, 1, 0)
  )
  # Insignificant correlation are crossed
  corrplot(
  rcorrelation$r,
  type = "upper",
  order = "hclust",
  p.mat = rcorrelation$P,
  sig.level = 0.01,
  insig = "pch",
  title = "Insignificant Crossed",
  mar = c(0, 0, 1, 0)
  )
  # HeatMap
  col <- colorRampPalette(c("blue", "white", "red"))(20)
  heatmap(x = correlation, col = col, symm = TRUE)
  mtest <- cor.mtest(truth_test, conf.level = .95)
  # Visualize Confidence Intervals
  corrplot(
  correlation,
  p.mat = mtest$p,
  method = "color",
  type = "upper",
  sig.level = c(.001, .01, .05),
  pch.cex = .9,
  insig = "label_sig",
  pch.col = "white",
  order = "hclust",
  title = "Confidence Intervals",
  mar = c(0, 0, 1, 0)
  )
}

flattenCorrMatrix <- function(cormat, pmat) {
  ut <- upper.tri(cormat)
  data.frame(
    row = rownames(cormat)[row(cormat)[ut]],
    column = rownames(cormat)[col(cormat)[ut]],
    cor  =(cormat)[ut],
    p = pmat[ut]
    )
}
```

Correlation
```{r}
makeAllCorrMatrix(truth_test)
makeAllCorrMatrix(truth_train)
makeAllCorrMatrix(tint_test)
makeAllCorrMatrix(tint_train)
makeAllCorrMatrix(lies_test)
makeAllCorrMatrix(lies_train)
makeAllCorrMatrix(lint_test)
makeAllCorrMatrix(lint_train)
```


Sums of occurence of all AU
```{r}
AU_count_T_train <- colSums(truth_train)
AU_count_T_test <- colSums(truth_test)
AU_count_L_train <- colSums(lies_train)
AU_count_L_test <- colSums(lies_test)

barplot(colMeans(truth_train), las=2)
barplot(colMeans(truth_test), las=2)
barplot(colMeans(lies_train), las=2)
barplot(colMeans(lies_test), las=2)

tr = data.frame(AU_count_T_train, AU_count_L_train)
train <- cbind(rownames(tr), tr)
rownames(train) <- NULL
colnames(train) <- c("AU_TRAIN", "TRUTH_TRAIN", "LIE_TRAIN")
train

te = data.frame(AU_count_T_test, AU_count_L_test)
test <- cbind(rownames(te), te)
rownames(test) <- NULL
colnames(test) <- c("AU_TEST", "TRUTH_TEST", "LIE_TEST")
test
```

Plots
```{r}
ggplot(data = train, aes(x = AU_TRAIN, y = TRUTH_TRAIN, fill = TRUTH_TRAIN)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = TRUTH_TRAIN), vjust = -0.5, size = 3.5) +
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5))

ggplot(data = train, aes(x = AU_TRAIN, y = LIE_TRAIN, fill = LIE_TRAIN)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = LIE_TRAIN), vjust = -0.5, size = 3.5) +
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5))

ggplot(data = test, aes(x = AU_TEST, y = TRUTH_TEST, fill = TRUTH_TEST)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = TRUTH_TEST), vjust = -0.5, size = 3.5) +
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5))

ggplot(data = test, aes(x = AU_TEST, y = LIE_TEST, fill = LIE_TEST)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(aes(label = LIE_TEST), vjust = -0.5, size = 3.5) +
  theme(axis.text.x = element_text(angle = 90, hjust = 0.5))

# tr = data.frame(AU_count_T_train, AU_count_L_train)
# train <- cbind(rownames(tr), tr)
# rownames(train) <- NULL
# colnames(train) <- c("AU", "TRUTH", "LIE")
# train
# 
# te = data.frame(AU_count_T_test, AU_count_L_test)
# test <- cbind(rownames(te), te)
# rownames(test) <- NULL
# colnames(test) <- c("AU", "TRUTH", "LIE")
# test
# 
# ggplot(NULL, aes(AU, TRUTH)) + 
#   geom_bar(stat = "identity", aes(fill = "TRUTH"), data = train, alpha = 0.5) +
#   geom_bar(stat = "identity", aes(fill = "TRUTH"), data = test, alpha = 0.5) +
#   theme(axis.text.x = element_text(angle = 90, hjust = 0.5)) 
# 
# test$name <- "test"
# train$name <- "train"
# d <- rbind(test, train)
# ggplot(d, aes(AU, LIE, fill = name)) +
#   geom_bar(stat = "identity", position = "dodge") +
#   geom_text(aes(label = LIE), vjust = -0.5, size = 2.5) +
#   theme(axis.text.x = element_text(angle = 90, hjust = 0.5))
```


SVM?
```{r}
```





